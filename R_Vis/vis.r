# install.packages("tidyverse", repos = "http://cran.us.r-project.org")
# install.packages("ggthemes", repos = "http://cran.us.r-project.org")
# install.packages("RSQLite", repos = "http://cran.us.r-project.org")
library(ggplot2)
# library(ggthemes)
library(RSQLite)

# Connect to the database (if not already connected)
if (!exists("db") || !dbIsValid(db)) {
  db <- dbConnect(RSQLite::SQLite(), "../data_collection/ucbwiki_data.db")
}

# Read the 'edits' table into a dataframe
edits_df <- dbReadTable(db, "edits")

# Show the structure of the dataframe
# str(edits_df)
# 'data.frame':   241406 obs. of  17 variables:
#  $ revid        : int  7489 7532 10015 14332 14334 14335 14336 14337 20900 31397 ...
#  $ parentid     : int  7438 7432 7421 0 14332 14334 14335 14336 20864 0 ...
#  $ pageid       : int  21531549 53754 740 20611385 20611385 20611385 20611385 20611385 30634 44634 ...
#  $ ns           : int  0 0 0 0 0 0 0 0 0 0 ...
#  $ title        : chr  "Return on investment" "Champagne" "Allah" "Polynesia" ...
#  $ user         : chr  "172.16.11.176" "172.16.11.176" "172.16.11.176" "128.32.57.96" ...
#  $ userid       : int  0 0 0 0 0 0 0 0 0 0 ...
#  $ timestamp    : chr  "2002-02-09T03:25:05Z" "2002-02-09T06:16:42Z" "2002-02-13T01:13:16Z" "2002-02-19T21:08:19Z" ...
#  $ comment      : chr  "*" "*" "*" "Very brief description of polynesia" ...
#  $ parsedcomment: chr  "*" "*" "*" "Very brief description of polynesia" ...
#  $ size         : int  401 162 1382 288 324 325 315 311 1676 143 ...
#  $ minor        : int  1 1 1 1 0 0 0 0 0 1 ...
#  $ bot          : int  0 0 0 0 0 0 0 0 0 0 ...
#  $ new          : int  0 0 0 1 0 0 0 0 0 1 ...
#  $ top          : int  0 0 0 0 0 0 0 0 0 0 ...
#  $ tags         : chr  "[]" "[]" "[]" "[]" ...
#  $ category     : chr  "UCLA_Main" "UCLA_Main" "UCLA_Main" "UCB_Misc" ...

# Data Preparation: Group by title and category and count edits
edit_counts <- edits_df %>%
  group_by(title, category) %>%
  summarise(n = n()) %>%
  ungroup()

# Display the first few rows of the aggregated data
head(edit_counts)

dbDisconnect(db)

